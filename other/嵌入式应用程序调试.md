#嵌入式应用程序调试

###strace

* 首先去[strace官网](http://sourceforge.net/projects/strace/)下载最新版本的Strace,在此，我已经把下载的好的4.11版本放在了百度云盘,[strace-4.11.tar.xz](http://pan.baidu.com/s/1gegmYR5),可以点击直接下载。
* 把下载好的文件解压并上传到ubuntu系统中。进入到解压后的目录`cd strace-4.11`执行配置文件命令：```./configure --host=arm-linux CC=arm-linux-gcc LD=arm-linux-ld```，然后进行编译`make`，最后，会在当前目录下生成strace可执行的二进制文件。
* 然后可以把strace拷贝到arm目的机上进行使用。```./strace -h```可以查看strace的帮助文档。比如：```./strace -o log.txt rmmod switch_addr```,这个就是把输出日志保存到log.txt文件里面，执行结束后，可对log.txt文件进行分析。

###gdb 

* [gdb官网](http://ftp.gnu.org/gnu/gdb/)下载最新版的gdb的源文件。也可以去百度网盘下载[gdb-7.10.1.tar.gz](http://pan.baidu.com/s/1geaNtXh).
* 在ubuntu中解压并进入解压后的目录：
    - 配置编译项：```./configure --target=arm-linux```
    - 编译：```make```
    - 在生成Makefile文件中有变量```prefix = /usr/local```，prefix变量指定的目录就是执行```make install```安装命令时安装的目录。这里可以把prefix变量tmp目录，看一下安装后的文件。```mkdir $PWD/tmps;  make install prefix=$PWD/tmp/```
    
* 进入目录```gdb-7.10.1/gdb/gdbserver```,:
    - 配置编译项：```./configure --host=arm-linux```
    - 编译：```make```
* 在当前目录下生成可执行的二进制文件```gdbserver```;

#####远程调试
* 目标机中
    执行命令gdbserver 10.0.12.144:1234 test

    注意test在编译的时候是要加-g选项的

* 宿主机中
    gdb test

    再输入命令target remote 10.0.12.143:1234

    接下来就可以gdb的调试了

* 说明
    目标机IP：10.0.12.143

    宿主机IP: 10.0.12.144

    端口是随意指定的，只要两端保持一致就行了

    test程序两端也必须相同



#####在X86 ubuntu调试arm目的机上生成的core  dump文件

* 在arm目的机执行命令：ulimit -c unlimited 。(使发生段错误的时候抛出core文件)
* 编译test.c测试文件，编译的时候加上标签```-g```，这样在调试的能获得更加详细的信息。
* 把core文件拷贝到ubuntu上面，用刚刚生成的arm-linux-gdb调试:```./arm-linux-gdb ./test ./core
* 在上面执行指令```make```编译之后，最好完全安装，而不是把目标文件安装到临时目录tmp，然后再拷贝到其他地方执行，这样可能会出现[错误](http://stackoverflow.com/questions/33657527/a-python-exception-error-in-gdb-7-10)。

测试文件：

    #include <stdio.h>
    void C(int *p)
    {
        *p = 0x12;
    }
    void B(int *p)
    {
        C(p);
    }
    void A(int *p)
    {
        B(p);
    }
    void A2(int *p)
    {
        C(p);
    }
    int main(int argc, char **argv)
    {
        int a;
        int *p = NULL;
        A2(&a);  // A2 > C
        printf("a = 0x%x\n", a);
        A(p);    // A > B > C
        return 0;
    }

输出的调试信息，可以看出，很详细：

    tyxm@ub:~/tmp/tmp$ arm-linux-gdb ./test ./core.1454
    GNU gdb (GDB) 7.10.1
    Copyright (C) 2015 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
    and "show warranty" for details.
    This GDB was configured as "--host=i686-pc-linux-gnu --target=arm-linux".
    Type "show configuration" for configuration details.
    For bug reporting instructions, please see:
    <http://www.gnu.org/software/gdb/bugs/>.
    Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.
    For help, type "help".
    Type "apropos word" to search for commands related to "word"...
    Reading symbols from ./test...done.
    [New LWP 1454]
    warning: Could not load shared library symbols for 2 libraries, e.g. /lib/libc.so.6.
    Use the "info sharedlibrary" command to see the complete listing.
    Do you need "set solib-search-path" or "set sysroot"?
    Core was generated by `./test'.
    Program terminated with signal SIGSEGV, Segmentation fault.
    #0  0x000083cc in C (p=0x0) at test.c:6
    6           *p = 0x12;
    (gdb)
